<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TULLY’S COFFEE ビーンズ診断</title>
<style>
  :root{
    --bg:#000; --fg:#fff; --muted:#cfcfcf;
    --rail:#1b1b1b; --rail-border:#262626;
    --accentGrad: linear-gradient(90deg, #e95c1b 0%, #f8c63c 100%);
    --card: rgba(255,255,255,0.06); --card-border: rgba(255,255,255,0.10);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", Meiryo, Arial, sans-serif;
    line-height:1.6; padding:1em;
  }
  .container{ max-width:600px; margin:auto; padding:1em; }

  h1{ text-align:center; font-weight:900; font-size:1.6em; line-height:1.3; margin:0 0 .4em; }
  h1 .tullys{ color:#e95c1b; }
  h1 .coffee{ color:#f8c63c; }
  h1 .beans { color:#fff; }

  /* 進捗 */
  .card{ background:var(--card); border:1px solid var(--card-border); border-radius:20px; padding:16px; backdrop-filter: blur(10px); }
  .progressdeck{ display:grid; grid-template-columns:64px 1fr 64px; align-items:center; gap:14px; margin:6px 0 18px; }
  .pnum{ text-align:center; font-weight:900; font-feature-settings:"tnum"; font-size:clamp(18px,3.5vw,22px); }
  .pnum .sub{ display:block; color:#a8a8a8; font-weight:600; font-size:.74em; letter-spacing:.02em; margin-top:-2px; }
  .prail{ position:relative; height:12px; border-radius:999px; background:var(--rail); border:1px solid var(--rail-border); overflow:hidden; }
  .pfiller{ position:absolute; inset:0 auto 0 0; width:0%; border-radius:999px; background:var(--accentGrad);
            box-shadow:0 0 0 1px rgba(255,255,255,0.06) inset, 0 4px 24px rgba(233,92,27,.35);
            transform-origin:left center; transition: width .35s cubic-bezier(.22,.61,.36,1); }
  .knob{ position:absolute; top:50%; translate:-50% -50%; width:22px; height:22px; border-radius:50%; background:#fff;
         mix-blend-mode:screen; opacity:.9; box-shadow:0 0 0 3px rgba(233,92,27,.25), 0 0 24px rgba(248,198,60,.45);
         transition:left .35s cubic-bezier(.22,.61,.36,1); left:0%; }

  /* QA & Result */
  button{
    display:block; width:100%; margin:.5em 0; padding:1em; font-size:1em;
    background-color:#6b4f3b; color:#fff; border:none; border-radius:12px;
    transition: background-color .15s ease, transform .15s ease; cursor:pointer;
  }
  button:hover{ background-color:#5a3f2b; transform:translateY(-1px) }
  button:active{ transform:translateY(0) }

  img{ max-width:100%; height:auto; border-radius:10px; margin-top:1em; display:block; }

  .question, .result{ display:none }
  .active{ display:block }

  .bean-name{
    font-size:1.5em; font-weight:900; text-align:center; background:#333; padding:.5em; border-radius:10px; margin:1em 0 .5em;
  }

  .footer{
    position:fixed; right:0; bottom:0; background-color:#e95caa; color:#fff;
    font-size:.9em; padding:.5em 1em; border-top-left-radius:10px; z-index:999;
  }

  @media (max-width:600px){
    h1{ font-size:1.3em }
    button{ font-size:.95em }
    .footer{ font-size:.8em }
    .progressdeck{ grid-template-columns:52px 1fr 52px; gap:10px }
    .prail{ height:10px }
    .knob{ width:18px; height:18px }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>
      <span class="tullys">TULLY’S</span> <span class="coffee">COFFEE</span><br>
      <span class="beans">ビーンズ診断</span>
    </h1>

    <!-- 進捗：左 現在 / 中央バー / 右 合計（ルートで可変） -->
    <div class="card" style="padding:14px 16px;">
      <div class="progressdeck" aria-label="診断の進行状況">
        <div class="pnum now"><span id="currIdx">1</span><span class="sub">現在</span></div>
        <div class="prail" role="progressbar" aria-valuemin="1" aria-valuemax="3" aria-valuenow="1">
          <div id="pfiller" class="pfiller"></div>
          <div id="knob" class="knob" aria-hidden="true"></div>
        </div>
        <div class="pnum total"><span id="totalCount">3</span><span class="sub">合計</span></div>
      </div>
    </div>

    <!-- ====== フローチャート（分岐型・可変ステップ対応） ====== -->

    <!-- Q1：最初の分岐（全ルート共通：ステップ1） -->
    <div id="q1" class="question active">
      <p>どんな味わいのコーヒーが好き？</p>
      <button onclick="goNext('q2a')">すっきり・爽やか</button>
      <button onclick="goNext('q2b')">香ばしくバランス良く</button>
      <button onclick="goNext('q2c')">コク深くビター</button>
    </div>

    <!-- Q2a：すっきり派（このルートは最大4問） -->
    <div id="q2a" class="question">
      <p>香りのタイプはどっち？</p>
      <button onclick="showResult('ethiopia')">ベリーのように華やか</button>
      <button onclick="goNext('q3a')">柑橘・花のように爽やか</button>
    </div>

    <!-- Q3a：すっきり×柑橘・花（更に絞る：Q4aへ） -->
    <div id="q3a" class="question">
      <p>爽やか系の中で、どちらが近い？</p>
      <button onclick="goNext('q4a')">キレの良さ・クリア感</button>
      <button onclick="goNext('q4a')">やさしさ・朝に合う</button>
    </div>

    <!-- Q4a：最終分岐（選び直しがあってもOKな文言に） -->
    <div id="q4a" class="question">
      <p>飲むシーンに合わせると？</p>
      <button onclick="showResult('laminita')">食事と爽やかに（コスタリカ ラミニータ）</button>
      <button onclick="showResult('piccolo')">朝に軽やかに（ピッコロバンビーノ）</button>
      <button onclick="showResult('mochajava')">香りを少し強調したい（モカジャバ）</button>
    </div>

    <!-- Q2b：バランス派（このルートは3問） -->
    <div id="q2b" class="question">
      <p>甘さ・口当たりのイメージは？</p>
      <button onclick="showResult('houseblend')">黒糖のようなまろやかさ</button>
      <button onclick="showResult('fazenda')">ナッツの香ばしさ</button>
      <button onclick="showResult('blackthree')">とろっと濃厚な口当たり</button>
      <button onclick="showResult('mochajava')">香りをしっかり楽しみたい</button>
    </div>

    <!-- Q2c：ビター派（このルートは3問） -->
    <div id="q2c" class="question">
      <p>飲み方はどちらが多い？</p>
      <button onclick="goNext('q3d')">ブラックで楽しむ</button>
      <button onclick="goNext('q3c')">ミルクと合わせる</button>
    </div>

    <!-- Q3c：ビター×ミルク -->
    <div id="q3c" class="question">
      <p>ミルクと合わせるなら？</p>
      <button onclick="showResult('espresso')">濃厚ビターをしっかり（エスプレッソクラシコ）</button>
      <button onclick="showResult('cafemonale')">まろやかでやさしく（カフェモナーレ）</button>
    </div>

    <!-- Q3d：ビター×ブラック -->
    <div id="q3d" class="question">
      <p>ブラックの好みは？</p>
      <button onclick="showResult('french')">スモーキーで力強く（フレンチロースト）</button>
      <button onclick="showResult('blackthree')">香ばしい甘みとコク（ブラックスリー）</button>
    </div>

    <!-- 診断結果 -->
    <div id="result" class="result">
      <h2>あなたにぴったりの豆は…</h2>
      <div id="beanName" class="bean-name"></div>
      <img id="beanImage" src="" alt="おすすめ豆">
      <p id="beanDesc"></p>
      <button onclick="restart()">はじめに戻る</button>
    </div>
  </div>

  <div class="footer">タリーズコーヒー　イオンモール筑紫野</div>

  <script>
    /* 画像＆文言（ファイル名はそのまま使う想定） */
    const beans = {
      espresso: {
        name: "エスプレッソクラシコ",
        image: "espresso.jpg",
        desc: "力強い味とビターチョコのような甘みを併せ持つ。"
      },
      houseblend: {
        name: "ハウスブレンド",
        image: "house_blend.jpg",
        desc: "ほどよい酸味とまろやかなコクが楽しめる、バランスの良い定番ブレンドです。毎日飲みたくなる、やさしい味わいです。"
      },
      mochajava: {
        name: "モカジャバ",
        image: "mocha_java.jpg",
        desc: "華やかなアロマとやさしい酸味。リラックスタイムにぴったり。"
      },
      ethiopia: {
        name: "エチオピアモカ",
        image: "ethiopia_uraga.jpg",
        desc: "ベリーのように華やかな香りと爽やかな酸味。"
      },
      fazenda: {
        name: "ブラジル ファゼンダ",
        image: "fazenda.jpg",
        desc: "ナッツのような香ばしさとコクのある甘み。"
      },
      laminita: {
        name: "コスタリカ ラミニータ",
        image: "laminita.jpg",
        desc: "柑橘系の爽やかな酸味とクリアな後味。"
      },
      cafemonale: {
        name: "カフェモナーレ",
        image: "cafe_monale.jpg",
        desc: "ミルクに合うまろやかな甘みとやさしいコク。"
      },
      french: {
        name: "フレンチロースト",
        image: "french_roast.jpg",
        desc: "スモーキーで深いコク。力強いビターの余韻。"
      },
      blackthree: {
        name: "ブラックスリー",
        image: "black_three.jpg",
        desc: "とろっとした口当たり、香ばしさと甘みのバランス。"
      },
      piccolo: {
        name: "ピッコロバンビーノ",
        image: "piccolo_bambino.jpg",
        desc: "軽やかでマイルド。キャラメルのような香ばしさ。朝にぴったり。"
      }
    };

    /* 進捗（可変対応）：現在ステップと、そのルートの合計ステップ */
    let currentStep = 1;
    let currentTotal = 3; // 初期表示は3（選択で動的に更新）

    // 各ノードに入った時点での想定合計ステップ
    // - すっきり（q2a→q3a→q4a→result）は4
    // - バランス（q2b→result）は3
    // - ビター（q2c→q3→result）は3
    const TOTAL_BY_NODE = {
      q1: 3,      // 初期値（分岐後に上書き）
      q2a: 4, q3a: 4, q4a: 4,
      q2b: 3,
      q2c: 3, q3c: 3, q3d: 3,
      result: null // 結果時は現状のcurrentTotalを維持
    };

    function setTotalForNode(nodeId){
      const t = TOTAL_BY_NODE[nodeId];
      if (typeof t === 'number') {
        currentTotal = t;
      }
      document.getElementById('totalCount').textContent = currentTotal;
      const pr = document.querySelector('.prail');
      pr.setAttribute('aria-valuemax', String(currentTotal));
    }

    function updateProgress(){
      document.getElementById('currIdx').textContent = currentStep;
      const pct = Math.max(0, Math.min(100, (currentStep / currentTotal) * 100));
      document.getElementById('pfiller').style.width = pct + '%';
      document.getElementById('knob').style.left = pct + '%';
      const pr = document.querySelector('.prail');
      pr.setAttribute('aria-valuenow', String(currentStep));
    }

    function showOnly(id){
      document.querySelectorAll('.question, .result').forEach(el => el.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function goNext(id) {
      currentStep += 1;
      setTotalForNode(id);
      showOnly(id);
      updateProgress();
    }

    function showResult(key) {
      const bean = beans[key];
      currentStep += 1; // 結果に到達＝1手前進
      setTotalForNode('result'); // total は現行保持
      document.getElementById("beanName").textContent = bean.name;
      document.getElementById("beanImage").src = bean.image; // ファイル名のみ
      document.getElementById("beanDesc").textContent = bean.desc;
      showOnly("result");
      updateProgress();
    }

    function restart() {
      currentStep = 1;
      currentTotal = 3;
      setTotalForNode('q1');
      showOnly("q1");
      updateProgress();
    }

    // 初期化
    setTotalForNode('q1');
    updateProgress();
  </script>
</body>
</html>
